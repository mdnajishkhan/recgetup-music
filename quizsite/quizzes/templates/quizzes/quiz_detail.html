{% extends 'quizzes/base.html' %}
{% block content %}
<div class="text-center max-w-2xl mx-auto bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl p-6 md:p-10 shadow-xl">
  <h2 class="text-3xl font-extrabold text-white mb-4">{{ quiz.title }}</h2>
  <p class="text-gray-300 mb-6">{{ quiz.description }}</p>

  <!-- Start Quiz Button -->
  <!-- Start Quiz Button -->
  {% if quiz.quiz_type == 'hackathon' %}
      <button onclick="openStartModal()"
         class="bg-gradient-to-r from-green-500 via-blue-500 to-purple-500 text-white px-6 py-3 rounded-full font-semibold hover:scale-105 transition shadow-lg hover:shadow-purple-500/30">
         Start Hackathon Quiz â†’
      </button>
  {% else %}
      <a href="{% url 'start_quiz' quiz.id %}"
         class="inline-block bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white px-6 py-3 rounded-full font-semibold hover:scale-105 transition shadow-lg hover:shadow-purple-500/30">
         Start Practice Quiz â†’
      </a>
  {% endif %}

</div>
{% endblock %}

{% block scripts %}
<style>
    /* 3D Scene Setup */
    #countdownOverlay {
        perspective: 1000px;
        background: radial-gradient(circle at center, #1e1e2e 0%, #000000 100%);
    }

    /* Vibrant Neon 3D Text Shadow */
    .text-3d {
        text-shadow: 
            0 1px 0 #3b82f6,
            0 2px 0 #2563eb,
            0 3px 0 #1d4ed8,
            0 4px 0 #1e40af,
            0 5px 0 #1e3a8a,
            0 6px 1px rgba(0,0,0,.1),
            0 0 5px rgba(0,0,0,.1),
            0 1px 3px rgba(0,0,0,.3),
            0 3px 5px rgba(0,0,0,.2),
            0 5px 10px rgba(0,0,0,.25),
            0 10px 10px rgba(0,0,0,.2),
            0 20px 20px rgba(0,0,0,.15);
        filter: drop-shadow(0 0 20px rgba(59, 130, 246, 0.5));
    }

    /* Cinematic slam-in animation */
    @keyframes cinematicIn {
        0% { transform: scale(4) translateZ(200px) rotateX(20deg); opacity: 0; filter: blur(10px); }
        40% { transform: scale(0.9) translateZ(0) rotateX(0deg); opacity: 1; filter: blur(0px); }
        60% { transform: scale(1.1) translateZ(50px) rotateX(-5deg); }
        80% { transform: scale(1) translateZ(0) rotateX(0deg); }
        100% { transform: scale(1.5) translateZ(100px); opacity: 0; filter: blur(5px); }
    }
    
    .animate-cinematic-in {
        animation: cinematicIn 1s ease-in-out forwards;
    }

    /* Final "Good Luck" specific */
    @keyframes finalPulse {
        0% { transform: scale(0.5); opacity: 0; }
        50% { transform: scale(1.1); opacity: 1; }
        100% { transform: scale(1); opacity: 1; }
    }
    .animate-final {
        animation: finalPulse 1.5s ease-out forwards;
    }
</style>

<!-- Countdown Overlay -->
<div id="countdownOverlay" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black overflow-hidden">
    <!-- Particles or flash effect can go here if needed -->
    <div id="countdownText" class="text-9xl md:text-[15rem] leading-none font-black text-transparent bg-clip-text bg-gradient-to-br from-cyan-400 via-blue-500 to-purple-600 text-3d opacity-0 transition-opacity duration-75">
        3
    </div>
</div>

<!-- Custom Start Quiz Modal -->
<div id="startModal" class="fixed inset-0 z-[80] hidden flex items-center justify-center bg-gray-900/90 backdrop-blur-xl transition-opacity duration-300 opacity-0 pointer-events-none">
  <div class="bg-gray-900 border border-white/10 rounded-2xl p-6 max-w-2xl w-full text-left shadow-2xl transform scale-95 transition-transform duration-300 relative overflow-hidden" id="startModalContent">
    
    <!-- Header -->
    <div class="flex items-center gap-3 mb-6 border-b border-white/10 pb-4">
        <div class="h-10 w-10 rounded-full bg-blue-500/20 flex items-center justify-center">
            <svg class="h-6 w-6 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        </div>
        <h3 class="text-2xl font-bold text-white">Ready for the Challenge?</h3>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <!-- Strict Rules -->
        <div class="space-y-3">
            <h4 class="text-red-400 font-bold uppercase text-xs tracking-wider mb-2">â›” Strict Rules (Auto-Submit)</h4>
            <ul class="space-y-2 text-sm text-gray-300">
                <li class="flex items-start gap-2">
                    <span class="text-red-500 mt-0.5">âœ–</span>
                    <span>No <strong>Tab Switching</strong></span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-red-500 mt-0.5">âœ–</span>
                    <span>No <strong>Page Refresh</strong></span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-red-500 mt-0.5">âœ–</span>
                    <span>No <strong>Back Button</strong> navigation</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-red-500 mt-0.5">âœ–</span>
                    <span>No <strong>Inspect Element</strong> tools</span>
                </li>
            </ul>
        </div>

        <!-- Lifelines -->
        <div class="space-y-3">
            <h4 class="text-purple-400 font-bold uppercase text-xs tracking-wider mb-2">ðŸ†˜ Available Lifelines</h4>
            <ul class="space-y-3 text-sm text-gray-300">
                <li class="flex items-center gap-3 bg-white/5 p-2 rounded-lg">
                    <div class="h-10 w-10 flex items-center justify-center rounded-full bg-blue-500/10">
                        <!-- SVG: Split Circle -->
                        <svg class="w-6 h-6 text-blue-400 filter drop-shadow-[0_0_8px_rgba(96,165,250,0.5)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v18m0-18C7.029 3 3 7.029 3 12s4.029 9 9 9 9-4.029 9-9-4.029-9-9-9z" />
                        </svg>
                    </div>
                    <div>
                        <span class="block font-bold text-white text-xs">50-50</span>
                        <span class="text-xs text-gray-400">Removes 2 wrong options</span>
                    </div>
                </li>
                <li class="flex items-center gap-3 bg-white/5 p-2 rounded-lg">
                    <div class="h-10 w-10 flex items-center justify-center rounded-full bg-green-500/10">
                        <!-- SVG: Bar Chart -->
                        <svg class="w-6 h-6 text-green-400 filter drop-shadow-[0_0_8px_rgba(74,222,128,0.5)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div>
                        <span class="block font-bold text-white text-xs">Audience Poll</span>
                        <span class="text-xs text-gray-400">See what others voted</span>
                    </div>
                </li>
                <li class="flex items-center gap-3 bg-white/5 p-2 rounded-lg">
                    <div class="h-10 w-10 flex items-center justify-center rounded-full bg-purple-500/10">
                         <!-- SVG: Sparkles -->
                        <svg class="w-6 h-6 text-purple-400 filter drop-shadow-[0_0_8px_rgba(192,132,252,0.5)]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                           <path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                        </svg>
                    </div>
                    <div>
                        <span class="block font-bold text-white text-xs">Tgays AI</span>
                        <span class="text-xs text-gray-400">Get a smart hint</span>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    
    <!-- Agreement & Actions -->
    <div class="bg-gray-800/50 -mx-6 -mb-6 p-6 border-t border-white/10">
        <label class="flex items-center gap-3 mb-6 cursor-pointer group">
            <input type="checkbox" id="rulesConsent" onchange="toggleStartButton()" class="w-5 h-5 rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-gray-900 transition">
            <span class="text-gray-300 text-sm group-hover:text-white transition">I understand the rules and am ready to start.</span>
        </label>

        <div class="flex justify-end gap-3">
            <button onclick="closeStartModal()" 
                    class="px-5 py-2.5 rounded-xl bg-gray-700 text-white hover:bg-gray-600 transition font-medium text-sm">
                Cancel
            </button>
            <a href="#" onclick="startCountdown('{% url 'start_quiz' quiz.id %}')" id="btnStartQuiz"
               class="px-6 py-2.5 rounded-xl bg-gray-600 text-gray-400 font-bold text-sm flex items-center gap-2 pointer-events-none transition-all duration-300 grayscale opacity-50">
                <span>Start Quiz</span>
                <span>â†’</span>
            </a>
        </div>
    </div>
  </div>
</div>

<script>
  const startModal = document.getElementById('startModal');
  const startModalContent = document.getElementById('startModalContent');
  const footer = document.getElementById('main-footer');

  function openStartModal() {
      startModal.classList.remove('hidden');
      if(footer) footer.classList.add('opacity-0', 'pointer-events-none'); // Hide footer
      
      // Small delay for transition
      setTimeout(() => {
          startModal.classList.remove('opacity-0', 'pointer-events-none');
          startModalContent.classList.remove('scale-95');
          startModalContent.classList.add('scale-100');
      }, 10);
  }

  function closeStartModal() {
      startModal.classList.add('opacity-0', 'pointer-events-none');
      startModalContent.classList.remove('scale-100');
      startModalContent.classList.add('scale-95');
      if(footer) footer.classList.remove('opacity-0', 'pointer-events-none'); // Show footer
      
      setTimeout(() => {
          startModal.classList.add('hidden');
      }, 300);
  }

  // Close on click outside
  startModal.addEventListener('click', (e) => {
      if (e.target === startModal) {
          closeStartModal();
      }
  });

  function toggleStartButton() {
      const checkbox = document.getElementById('rulesConsent');
      const btn = document.getElementById('btnStartQuiz');
      
      if (checkbox.checked) {
          btn.classList.remove('pointer-events-none', 'grayscale', 'opacity-50', 'bg-gray-600', 'text-gray-400');
          btn.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-indigo-600', 'text-white', 'shadow-lg', 'hover:from-blue-600', 'hover:to-indigo-700');
      } else {
          btn.classList.add('pointer-events-none', 'grayscale', 'opacity-50', 'bg-gray-600', 'text-gray-400');
          btn.classList.remove('bg-gradient-to-r', 'from-blue-500', 'to-indigo-600', 'text-white', 'shadow-lg', 'hover:from-blue-600', 'hover:to-indigo-700');
      }
  }
  function startCountdown(url) {
      // Prevent double clicks if button is disabled effectively
      const btn = document.getElementById('btnStartQuiz');
      if (btn.classList.contains('pointer-events-none')) return;

      // Close modal
      closeStartModal(); // Assumes this function exists and works
      
      // Show overlay
      const overlay = document.getElementById('countdownOverlay');
      const text = document.getElementById('countdownText');
      overlay.classList.remove('hidden');
      
      // Sequence: 3 -> 2 -> 1 -> Quote -> Go
      let count = 3;
      
      const quotes = [
          "Go for the win ðŸ’ª", "Make it count!", "Stay sharp ðŸ”¥", "Give your 100%", 
          "Youâ€™ll rock it ðŸŽ¯", "Success is yours!", "Keep pushing!", "Nail it âœ¨", 
          "Crush it ðŸš€", "Stay focused!", "Win with confidence", "Make us proud ðŸŒŸ", 
          "Dream. Believe. Achieve.", "Trust yourself", "Own the moment", "Stay unstoppable", 
          "Give it your best", "Rise and shine âœ¨", "Power through ðŸ’¥", "Make it happen", 
          "Go beyond limits", "Stay fearless", "Youâ€™ve got this ðŸ’¯", "Chase excellence", 
          "Be bold", "Shine bright ðŸŒŸ", "Stay strong ðŸ’ª", "Focus and win", 
          "Believe in your journey", "Keep moving forward", "Play to your strengths", 
          "Give it all youâ€™ve got", "Level up ðŸš€", "Stay positive", "Perform your best", 
          "Aim high ðŸŽ¯", "Trust the process", "Stay motivated", "Break boundaries", 
          "Go all in", "Create your success", "Stay confident", "Keep the fire alive ðŸ”¥", 
          "Make today count", "Success starts now", "No fear, just focus", "Prove yourself", 
          "Stay determined", "Make it unforgettable", "Finish strong ðŸ’ª", "Give it your moment", 
          "Stand out ðŸŒŸ", "Keep believing", "Win your way", "Show your potential", 
          "Stay committed", "Push your limits", "Walk in with confidence", 
          "Make yourself proud", "You are ready âœ¨"
      ];

      const gradients = [
          "from-cyan-400 via-blue-500 to-purple-600", // Default Neon
          "from-red-500 via-orange-500 to-yellow-500", // Fire
          "from-green-400 via-emerald-500 to-teal-600", // Nature
          "from-pink-500 via-rose-500 to-red-600", // Passion
          "from-violet-500 via-purple-500 to-fuchsia-600", // Magic
          "from-yellow-400 via-amber-500 to-orange-600", // Gold
          "from-blue-400 via-indigo-500 to-violet-600", // Deep Sea
          "from-teal-400 via-cyan-500 to-sky-600", // Sky
          "from-fuchsia-500 via-pink-500 to-rose-500", // Candy
          "from-lime-400 via-green-500 to-emerald-600" // Toxic
      ];

      // Pick randoms
      const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
      const randomGradient = gradients[Math.floor(Math.random() * gradients.length)];

      // Apply gradient
      text.className = `text-9xl md:text-[15rem] leading-none font-black text-transparent bg-clip-text bg-gradient-to-br ${randomGradient} text-3d opacity-0 transition-opacity duration-75`;

      function playStep() {
          if (count > 0) {
              text.innerText = count;
              text.classList.remove('animate-cinematic-in', 'animate-final');
              
              // Reset
              void text.offsetWidth; 
              
              text.classList.add('animate-cinematic-in');
              count--;
              setTimeout(playStep, 1000); // 1s per number
          } else {
              text.innerText = randomQuote;
              text.classList.remove('animate-cinematic-in', 'text-9xl', 'md:text-[15rem]', 'text-3d');
              // For final text, we keep the same gradient but smaller size
              text.className = `text-4xl md:text-8xl leading-tight font-black text-transparent bg-clip-text bg-gradient-to-br ${randomGradient} animate-final drop-shadow-lg text-center px-4`;
              
              // Redirect
              setTimeout(() => {
                  window.location.href = url;
              }, 2000); // Slightly longer for reading the quote
          }
      }
      
      playStep();
  }
</script>
{% endblock %}
